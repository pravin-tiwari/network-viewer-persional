{"version":3,"file":"NetworkProvider.js","sources":["../../../src/state/network/NetworkProvider.jsx"],"sourcesContent":["import React, { useEffect, useReducer, useMemo } from 'react';\nimport PropTypes from 'prop-types';\n\nimport { reducer, initialState as defaultState } from './reducer';\nimport { updateData, fetchFile, updateScrollToIndex } from './actions';\nimport { NetworkContext } from './Context';\nimport { findRequestIndex } from '../../utils';\nimport { ROW_ID_PREFIX } from '../../constants';\n\nconst NetworkProvider = (props) => {\n  const {\n    data,\n    file,\n    fetchOptions,\n    initialState,\n    scrollTimeStamp,\n    scrollRequestPosition,\n    autoHighlightChange,\n    onDataLoaded,\n    onDataError,\n  } = props;\n\n  const [state, dispatch] = useReducer(reducer, initialState);\n  const value = useMemo(() => [state, dispatch], [state]);\n  const selectedReqIndex = value[0].get('selectedReqIndex');\n  const requestData = value[0].get('data');\n  const showReqDetail = value[0].get('showReqDetail');\n  const actualData = value[0].get('actualData');\n  const error = value[0].get('error');\n\n  // Update data onChange of network data\n  useEffect(() => {\n    if (data && data.log && data.log.entries) {\n      updateData(dispatch)({\n        entries: data.log.entries,\n        pages: data.log.pages,\n      });\n    }\n  }, [data]);\n\n  // Fetch HAR file onChange of file prop\n  useEffect(() => {\n    if (file) {\n      fetchFile(dispatch)(file, fetchOptions);\n    }\n  }, [file]);\n\n  useEffect(() => {\n    if (actualData.size && onDataLoaded) {\n      onDataLoaded(actualData);\n    }\n  }, [actualData]);\n\n  useEffect(() => {\n    if (error && onDataError) {\n      onDataError(error);\n    }\n  }, [error]);\n\n  // Find nearby request-rowId and update scrollIndex on scrollTimeStamp receive\n  useEffect(() => {\n    const shouldChangeHighlight = showReqDetail ? autoHighlightChange : true;\n    if (scrollTimeStamp && shouldChangeHighlight) {\n      const reqIndex = findRequestIndex({\n        data: requestData,\n        timestamp: scrollTimeStamp,\n        position: scrollRequestPosition,\n      });\n      if (reqIndex || reqIndex === 0) {\n        updateScrollToIndex(dispatch)(requestData.get(reqIndex));\n      }\n    }\n  }, [scrollTimeStamp, actualData]);\n\n  // Scroll to request row onChange of scrollToIndex\n  // setTimeout is required when reqDetail is visible,\n  // it allows DOM to adjust before we scroll it to highlighted request\n  useEffect(() => {\n    if (selectedReqIndex) {\n      setTimeout(() => {\n        const element = document.getElementById(ROW_ID_PREFIX + selectedReqIndex);\n        if (element) {\n          element.scrollIntoView({\n            alignToTop: true,\n            behavior: 'smooth',\n          });\n        }\n      }, 300);\n    }\n  }, [selectedReqIndex]);\n\n  return (\n    <NetworkContext.Provider\n      value={value}\n      {...props}\n    />\n  );\n};\n\nNetworkProvider.propTypes = {\n  autoHighlightChange: PropTypes.bool,\n  data: PropTypes.object,\n  fetchOptions: PropTypes.object,\n  file: PropTypes.string,\n  initialState: PropTypes.object,\n  onDataError: PropTypes.func,\n  onDataLoaded: PropTypes.func,\n  scrollRequestPosition: PropTypes.oneOf(['before', 'after', 'near']),\n  scrollTimeStamp: PropTypes.number,\n};\n\nNetworkProvider.defaultProps = {\n  autoHighlightChange: false,\n  data: null,\n  fetchOptions: { withCredentials: true },\n  file: null,\n  initialState: defaultState,\n  onDataError: null,\n  onDataLoaded: null,\n  scrollRequestPosition: 'near',\n  scrollTimeStamp: null,\n};\n\nexport default NetworkProvider;\n"],"names":["NetworkProvider","props","data","file","fetchOptions","initialState","scrollTimeStamp","scrollRequestPosition","autoHighlightChange","onDataLoaded","onDataError","useReducer","reducer","state","dispatch","value","useMemo","selectedReqIndex","get","requestData","showReqDetail","actualData","error","useEffect","log","entries","updateData","pages","fetchFile","size","shouldChangeHighlight","reqIndex","findRequestIndex","timestamp","position","updateScrollToIndex","setTimeout","element","document","getElementById","ROW_ID_PREFIX","scrollIntoView","alignToTop","behavior","propTypes","PropTypes","bool","object","string","func","oneOf","number","defaultProps","withCredentials","defaultState"],"mappings":"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"}